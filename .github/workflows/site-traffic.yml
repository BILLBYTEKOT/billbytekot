name: Keep Alive & Traffic

on:
  schedule:
    # Run every 5 minutes to keep Render alive (free tier sleeps after 15 min)
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Wake Up Backend
        run: |
          echo "ðŸ’“ Keeping BillByteKOT alive..."
          
          # Try to wake up Render backend
          for i in 1 2 3 4 5; do
            status=$(curl -s -o /dev/null -w "%{http_code}" "https://restro-ai.onrender.com/health" --max-time 45 2>/dev/null || echo "000")
            if [ "$status" = "200" ]; then
              echo "âœ… Backend alive (attempt $i)"
              break
            fi
            echo "â³ Waking up... (attempt $i, status: $status)"
            sleep 8
          done

      - name: Visit Frontend
        run: |
          curl -s -o /dev/null "https://billbytekot.in" --max-time 20 2>/dev/null || true
          echo "âœ… Frontend pinged"

      - name: Quick Health Summary
        run: |
          echo "ðŸ“Š Status Check:"
          echo "  Backend: $(curl -s -o /dev/null -w '%{http_code}' 'https://restro-ai.onrender.com/health' --max-time 10 2>/dev/null || echo 'timeout')"
          echo "  Frontend: $(curl -s -o /dev/null -w '%{http_code}' 'https://billbytekot.in' --max-time 10 2>/dev/null || echo 'timeout')"
