<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Dialog Print Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #22c55e;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .test-button:hover {
            background: #16a34a;
            transform: translateY(-1px);
        }
        .danger-button {
            background: #ef4444;
        }
        .danger-button:hover {
            background: #dc2626;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }
        .success { background: #dcfce7; color: #166534; }
        .info { background: #dbeafe; color: #1d4ed8; }
        .warning { background: #fef3c7; color: #d97706; }
        .receipt-sample {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background: #f8f9fa;
            border: 2px dashed #ccc;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-line;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö´ No Dialog Print Test</h1>
        <p><strong>Goal:</strong> Test printing methods that completely avoid browser print dialogs.</p>
        
        <div class="status info">
            <strong>‚úÖ Expected Result:</strong> No "Save as PDF" dialog should appear when testing silent print methods below.
        </div>

        <h2>ü§´ Silent Print Methods</h2>
        
        <h3>Method 1: Background Processing</h3>
        <p>Prepares receipt without triggering any browser dialogs:</p>
        <button class="test-button" onclick="testBackgroundPrint()">Test Background Print</button>
        <div id="background-result"></div>

        <h3>Method 2: CSS-Only Formatting</h3>
        <p>Formats receipt for printing without window.print() calls:</p>
        <button class="test-button" onclick="testCSSOnlyPrint()">Test CSS-Only Print</button>
        <div id="css-result"></div>

        <h3>Method 3: Storage-Based Approach</h3>
        <p>Stores receipt data for later manual printing:</p>
        <button class="test-button" onclick="testStoragePrint()">Test Storage Print</button>
        <div id="storage-result"></div>

        <h3>‚ö†Ô∏è Comparison: Traditional Method (Will Show Dialog)</h3>
        <p><strong>Warning:</strong> This will show the print dialog (for comparison):</p>
        <button class="test-button danger-button" onclick="testTraditionalPrint()">‚ö†Ô∏è Test Traditional Print (Shows Dialog)</button>
        <div id="traditional-result"></div>

        <h2>üìÑ Sample Receipt</h2>
        <div class="receipt-sample" id="sample-receipt">
================================
        TEST RESTAURANT
================================
Bill No: 00001    Table: T1
Date: ${new Date().toLocaleDateString()}
Time: ${new Date().toLocaleTimeString()}
--------------------------------
Item            Qty  Rate   Amt
--------------------------------
Test Item 1       1  100.00  100.00
Test Item 2       2   50.00  100.00
--------------------------------
Sub Total         3     -    200.00
Tax (5.0%)                   10.00
================================
TOTAL DUE                   210.00
================================
Payment Mode:              CASH
Amount Received:          250.00
Change to Return:          40.00
Status:                    PAID
================================
    Thank you! Visit Again...
================================
        </div>
    </div>

    <script>
        // Mock toast function
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Method 1: Background processing without dialogs
        function testBackgroundPrint() {
            const receiptContent = document.getElementById('sample-receipt').textContent;
            
            try {
                // Create hidden container
                const container = document.createElement('div');
                container.id = 'background-print-' + Date.now();
                container.style.cssText = `
                    position: absolute !important;
                    top: -10000px !important;
                    left: -10000px !important;
                    width: 1px !important;
                    height: 1px !important;
                    opacity: 0 !important;
                    overflow: hidden !important;
                `;
                
                container.innerHTML = `
                    <div style="font-family: 'Courier New', monospace; font-size: 12px;">
                        ${receiptContent}
                    </div>
                `;
                
                document.body.appendChild(container);
                
                // Store for later use
                localStorage.setItem('lastReceipt', JSON.stringify({
                    content: receiptContent,
                    timestamp: Date.now(),
                    method: 'background'
                }));
                
                setTimeout(() => {
                    if (document.body.contains(container)) {
                        document.body.removeChild(container);
                    }
                    showResult('background-result', '‚úÖ SUCCESS: Receipt prepared in background. No dialogs appeared!', 'success');
                }, 100);
                
            } catch (error) {
                showResult('background-result', '‚ùå ERROR: ' + error.message, 'warning');
            }
        }

        // Method 2: CSS-only formatting
        function testCSSOnlyPrint() {
            const receiptContent = document.getElementById('sample-receipt').textContent;
            
            try {
                // Add print styles without triggering print
                const printStyles = document.createElement('style');
                printStyles.id = 'css-print-styles-' + Date.now();
                printStyles.textContent = `
                    .receipt-formatted {
                        font-family: 'Courier New', monospace;
                        font-size: 12px;
                        line-height: 1.2;
                        width: 80mm;
                        background: white;
                        color: black;
                        padding: 2mm;
                    }
                    @media print {
                        .receipt-formatted {
                            position: absolute;
                            top: 0;
                            left: 0;
                            width: 80mm;
                        }
                        @page { size: 80mm auto; margin: 0; }
                    }
                `;
                
                document.head.appendChild(printStyles);
                
                // Create formatted content
                const formattedDiv = document.createElement('div');
                formattedDiv.className = 'receipt-formatted';
                formattedDiv.style.cssText = 'position: absolute; top: -5000px; left: -5000px;';
                formattedDiv.textContent = receiptContent;
                document.body.appendChild(formattedDiv);
                
                setTimeout(() => {
                    // Cleanup
                    if (document.head.contains(printStyles)) {
                        document.head.removeChild(printStyles);
                    }
                    if (document.body.contains(formattedDiv)) {
                        document.body.removeChild(formattedDiv);
                    }
                    showResult('css-result', '‚úÖ SUCCESS: Receipt formatted with CSS. Ready for Ctrl+P printing!', 'success');
                }, 200);
                
            } catch (error) {
                showResult('css-result', '‚ùå ERROR: ' + error.message, 'warning');
            }
        }

        // Method 3: Storage-based approach
        function testStoragePrint() {
            const receiptContent = document.getElementById('sample-receipt').textContent;
            
            try {
                // Store receipt data
                const receiptData = {
                    content: receiptContent,
                    paperWidth: '80mm',
                    timestamp: Date.now(),
                    method: 'storage',
                    formatted: true
                };
                
                localStorage.setItem('thermalReceipt', JSON.stringify(receiptData));
                sessionStorage.setItem('printReady', 'true');
                
                showResult('storage-result', '‚úÖ SUCCESS: Receipt stored for printing. Use Ctrl+P when ready!', 'success');
                
            } catch (error) {
                showResult('storage-result', '‚ùå ERROR: ' + error.message, 'warning');
            }
        }

        // Traditional method (will show dialog)
        function testTraditionalPrint() {
            const receiptContent = document.getElementById('sample-receipt').textContent;
            
            showResult('traditional-result', '‚ö†Ô∏è WARNING: This will open the print dialog...', 'warning');
            
            setTimeout(() => {
                try {
                    const printWindow = window.open('', '_blank', 'width=400,height=600');
                    if (printWindow) {
                        printWindow.document.write(`
                            <!DOCTYPE html>
                            <html>
                            <head>
                                <title>Receipt</title>
                                <style>
                                    body { font-family: 'Courier New', monospace; font-size: 12px; }
                                    @page { size: 80mm auto; margin: 0; }
                                </style>
                            </head>
                            <body>
                                <pre>${receiptContent}</pre>
                                <script>
                                    window.onload = function() {
                                        setTimeout(function() {
                                            window.print();
                                            setTimeout(function() { window.close(); }, 500);
                                        }, 200);
                                    };
                                </script>
                            </body>
                            </html>
                        `);
                        printWindow.document.close();
                        showResult('traditional-result', 'üìã Traditional method executed (dialog should have appeared)', 'info');
                    } else {
                        showResult('traditional-result', '‚ùå Popup blocked', 'warning');
                    }
                } catch (error) {
                    showResult('traditional-result', '‚ùå ERROR: ' + error.message, 'warning');
                }
            }, 1000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showResult('background-result', 'üöÄ Ready to test background printing', 'info');
            showResult('css-result', 'üöÄ Ready to test CSS-only formatting', 'info');
            showResult('storage-result', 'üöÄ Ready to test storage-based approach', 'info');
            showResult('traditional-result', '‚ö†Ô∏è Ready to test traditional method (will show dialog)', 'warning');
        });
    </script>
</body>
</html>